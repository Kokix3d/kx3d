<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="dark">
  <title>Unreal Plugins | Kx3d</title>
  
  <!-- Critical CSS - Prevents FOUC (Flash of Unstyled Content) -->
  <style>
    /* Base dark theme - instant first paint */
    html, body { 
      background: #000000 !important; 
      color: #ffffff !important; 
      margin: 0 !important;
      padding: 0 !important;
    }
    body {
      min-height: 100vh !important;
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif !important;
      line-height: 1.6 !important;
    }
    *, *::before, *::after { 
      box-sizing: border-box !important; 
    }
    
    /* Prevent default link styling (blue links) */
    a {
      color: #ffffff !important;
      text-decoration: none !important;
    }
    a:visited {
      color: #ffffff !important;
    }
    a:hover {
      color: rgba(255, 255, 255, 0.8) !important;
    }
    
    /* New Header - Critical FOUC prevention */
    body {
      padding-top: 64px !important;
    }
    @media (max-width: 768px) {
      body {
        padding-top: 56px !important;
      }
    }
    .main-header {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      right: 0 !important;
      z-index: 1000 !important;
      background: #000000 !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06) !important;
      height: 64px !important;
      display: flex !important;
      align-items: center !important;
      justify-content: space-between !important;
      padding: 0 1.5rem !important;
      box-sizing: border-box !important;
    }
    .main-header__logo {
      position: absolute !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      z-index: 1 !important;
    }
    .main-header__logo-image {
      height: 32px !important;
      width: auto !important;
      display: block !important;
    }
    .main-header__hamburger {
      background: transparent !important;
      border: none !important;
      cursor: pointer !important;
      padding: 0.5rem !important;
      display: flex !important;
      flex-direction: column !important;
      gap: 4px !important;
      z-index: 2 !important;
    }
    .main-header__hamburger-line {
      width: 24px !important;
      height: 2px !important;
      background: #ffffff !important;
      display: block !important;
    }
    .main-header__search-trigger {
      background: rgba(255, 255, 255, 0.05) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
      border-radius: 0.5rem !important;
      padding: 0.5rem !important;
      color: rgba(255, 255, 255, 0.8) !important;
      cursor: pointer !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      z-index: 2 !important;
    }
    .search-panel {
      position: fixed !important;
      top: 0 !important;
      right: 0 !important;
      width: 100% !important;
      height: 100vh !important;
      z-index: 9999 !important;
      pointer-events: none !important;
    }
    .search-panel__content {
      position: fixed !important;
      top: 0 !important;
      right: 0 !important;
      bottom: 0 !important;
      width: 400px !important;
      max-width: 85vw !important;
      background: #000000 !important;
      border-left: 1px solid rgba(255, 255, 255, 0.1) !important;
      transform: translateX(100%) !important;
      transition: transform 0.3s ease-in-out !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
      box-shadow: -4px 0 24px rgba(0, 0, 0, 0.5) !important;
    }
    .search-panel.active .search-panel__content {
      transform: translateX(0) !important;
      pointer-events: auto !important;
    }
    
    /* Container & Main content */
    .container {
      width: 100% !important;
      max-width: min(100rem, 100vw) !important;
      margin: 0 auto !important;
      padding: 0 clamp(1rem, 4vw, 2rem) !important;
    }
    .main {
      background: #000000 !important;
      color: #ffffff !important;
    }
    
    /* Dropdown menus - prevent unstyled flash */
    .dropdown {
      position: relative !important;
    }
    .dropdown-menu {
      background: rgba(0, 0, 0, 0.7) !important;
      border: 1px solid rgba(255, 255, 255, 0.1) !important;
      border-radius: 8px !important;
      list-style: none !important;
      padding: 8px 0 !important;
      margin: 0 !important;
    }
    .dropdown-menu a {
      color: rgba(255, 255, 255, 0.85) !important;
      text-decoration: none !important;
    }
    .dropdown-menu a:hover {
      background: rgba(255, 255, 255, 0.05) !important;
      color: #ffffff !important;
    }
    
    /* Buttons - prevent unstyled flash */
    button {
      background: transparent !important;
      border: none !important;
      color: #ffffff !important;
      cursor: pointer !important;
      font-family: inherit !important;
    }
    
    /* Inputs - prevent unstyled flash */
    input, textarea, select {
      background: transparent !important;
      color: #ffffff !important;
      border: none !important;
      font-family: inherit !important;
    }
    
    /* Lists - prevent default styling */
    ul, ol {
      list-style: none !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    
    /* Images - prevent layout shift */
    img {
      max-width: 100% !important;
      height: auto !important;
      display: block !important;
    }
  </style>
  
  <!-- Main stylesheet (blocking load to prevent FOUC) -->
  <link rel="stylesheet" href="../style.css">
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
</head>
<body>
  <!-- ============================================
       NEW HEADER - Three Zone Layout
       ============================================
       Zone 1: Left - Hamburger Menu (opens left slide panel)
       Zone 2: Center - Logo (perfectly centered)
       Zone 3: Right - Search Bar
       ============================================ -->
  <header class="main-header">
    <!-- Zone 1: Left - Hamburger + Unreal sub-nav -->
    <div class="main-header__left">
      <button class="main-header__hamburger" id="hamburgerBtn" aria-label="Open navigation menu">
        <span class="main-header__hamburger-line"></span>
        <span class="main-header__hamburger-line"></span>
        <span class="main-header__hamburger-line"></span>
      </button>
      <nav class="unreal-subnav" aria-label="Unreal section navigation">
        <a href="3d-models.html" class="unreal-subnav__link">3D Models</a>
        <a href="plugins.html" class="unreal-subnav__link unreal-subnav__link--active">Plugins</a>
        <a href="assets.html" class="unreal-subnav__link">Assets</a>
        <a href="courses.html" class="unreal-subnav__link">Courses</a>
      </nav>
    </div>
    <!-- Zone 2: Center - Logo -->
    <div class="main-header__logo">
      <a href="../index.html" class="main-header__logo-link">
        <img src="../logo/white.png" alt="Kx3D Logo" class="main-header__logo-image" width="120" height="40" loading="eager" fetchpriority="high">
      </a>
    </div>
    
    <!-- Zone 3: Right - Search Icon Trigger -->
    <button class="main-header__search-trigger" id="searchTrigger" aria-label="Open search">
      <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M13.89 12.22L17.5 15.83L15.83 17.5L12.22 13.89C11.24 14.58 10.05 15 8.75 15C5.3 15 2.5 12.2 2.5 8.75C2.5 5.3 5.3 2.5 8.75 2.5C12.2 2.5 15 5.3 15 8.75C15 10.05 14.58 11.24 13.89 12.22ZM8.75 13.33C11.24 13.33 13.33 11.24 13.33 8.75C13.33 6.26 11.24 4.17 8.75 4.17C6.26 4.17 4.17 6.26 4.17 8.75C4.17 11.24 6.26 13.33 8.75 13.33Z" fill="currentColor"/>
      </svg>
    </button>
  </header>

  <!-- ============================================
       LEFT SIDE SLIDE PANEL - Navigation Menu
       ============================================
       Completely separate from header - opens from left side
       ============================================ -->
  <div class="slide-panel" id="slidePanel">
    <div class="slide-panel__overlay" id="slidePanelOverlay"></div>
    <div class="slide-panel__content">
      <div class="slide-panel__header">
        <h2 class="slide-panel__title">Navigation</h2>
        <button class="slide-panel__close" id="slidePanelClose" aria-label="Close navigation menu">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <nav class="slide-panel__nav">
        <ul class="slide-panel__menu">
          <li><a href="../index.html" class="slide-panel__link">Home</a></li>
          <li><a href="../Membership/membership.html" class="slide-panel__link">Membership</a></li>
          <li class="slide-panel__item--has-children">
            <a href="../Blender/3d-models.html" class="slide-panel__link">
              <span>Blender</span>
              <svg class="slide-panel__chevron" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
            <ul class="slide-panel__submenu">
              <li><a href="../Blender/3d-models.html" class="slide-panel__sublink">3D Models</a></li>
              <li><a href="../Blender/addons.html" class="slide-panel__sublink">Addons</a></li>
              <li><a href="../Blender/assets.html" class="slide-panel__sublink">Assets</a></li>
              <li><a href="../Blender/brushes.html" class="slide-panel__sublink">Brushes</a></li>
              <li><a href="../Blender/courses.html" class="slide-panel__sublink">Courses</a></li>
            </ul>
          </li>
          <li class="slide-panel__item--has-children">
            <a href="3d-models.html" class="slide-panel__link">
              <span>Unreal</span>
              <svg class="slide-panel__chevron" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
            <ul class="slide-panel__submenu">
              <li><a href="3d-models.html" class="slide-panel__sublink">3D Models</a></li>
              <li><a href="plugins.html" class="slide-panel__sublink">Plugins</a></li>
              <li><a href="assets.html" class="slide-panel__sublink">Assets</a></li>
              <li><a href="courses.html" class="slide-panel__sublink">Courses</a></li>
            </ul>
          </li>
          <li class="slide-panel__item--has-children">
            <a href="../ae/plugins.html" class="slide-panel__link">
              <span>After Effects</span>
              <svg class="slide-panel__chevron" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
            <ul class="slide-panel__submenu">
              <li><a href="../ae/plugins.html" class="slide-panel__sublink">Plugins</a></li>
              <li><a href="../ae/assets.html" class="slide-panel__sublink">Assets</a></li>
              <li><a href="../ae/courses.html" class="slide-panel__sublink">Courses</a></li>
            </ul>
          </li>
          <li class="slide-panel__item--has-children">
            <a href="../pp/plugins.html" class="slide-panel__link">
              <span>Premiere Pro</span>
              <svg class="slide-panel__chevron" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
            <ul class="slide-panel__submenu">
              <li><a href="../pp/plugins.html" class="slide-panel__sublink">Plugins</a></li>
              <li><a href="../pp/assets.html" class="slide-panel__sublink">Assets</a></li>
              <li><a href="../pp/courses.html" class="slide-panel__sublink">Courses</a></li>
            </ul>
          </li>
          <li><a href="../photoshop.html" class="slide-panel__link">Photoshop</a></li>
          <li class="slide-panel__item--has-children">
            <a href="../Houdini/assets.html" class="slide-panel__link">
              <span>Houdini</span>
              <svg class="slide-panel__chevron" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
            <ul class="slide-panel__submenu">
              <li><a href="../Houdini/assets.html" class="slide-panel__sublink">Assets</a></li>
              <li><a href="../Houdini/courses.html" class="slide-panel__sublink">Courses</a></li>
            </ul>
          </li>
          <li><a href="../software.html" class="slide-panel__link">Software</a></li>
          <li><a href="../templates.html" class="slide-panel__link">Website Templates</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <!-- ============================================
       RIGHT SIDE SLIDE PANEL - Search Panel
       ============================================
       Completely separate from header - opens from right side
       Mirrors the left side navigation panel
       ============================================ -->
  <div class="search-panel" id="searchPanel">
    <div class="search-panel__overlay" id="searchPanelOverlay"></div>
    <div class="search-panel__content">
      <div class="search-panel__header">
        <h2 class="search-panel__title">Search</h2>
        <button class="search-panel__close" id="searchPanelClose" aria-label="Close search">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
      <div class="search-panel__body">
        <div class="search-panel__input-wrapper">
          <svg class="search-panel__input-icon" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.89 12.22L17.5 15.83L15.83 17.5L12.22 13.89C11.24 14.58 10.05 15 8.75 15C5.3 15 2.5 12.2 2.5 8.75C2.5 5.3 5.3 2.5 8.75 2.5C12.2 2.5 15 5.3 15 8.75C15 10.05 14.58 11.24 13.89 12.22ZM8.75 13.33C11.24 13.33 13.33 11.24 13.33 8.75C13.33 6.26 11.24 4.17 8.75 4.17C6.26 4.17 4.17 6.26 4.17 8.75C4.17 11.24 6.26 13.33 8.75 13.33Z" fill="currentColor"/>
          </svg>
          <input type="text" class="search-panel__input" id="searchInput" placeholder="Search all products..." autocomplete="off">
        </div>
        <div class="search-panel__results" id="searchResults">
          <div class="search-panel__results-list" id="searchResultsList"></div>
          <div class="search-panel__view-all" id="searchViewAll" style="display: none;">
            <a href="#" class="search-panel__view-all-link" id="viewAllLink">View all results</a>
          </div>
        </div>
      </div>
    </div>
  </div>

<main class="main product-listing-page">
  <div class="container">
    <div class="page-header">
      <h1 class="page-title">Unreal Plugins</h1>
      <p class="product-count" id="productCount">0 Plugins</p>
    </div>

    <div class="page-controls">
      <div class="showing-text" id="showingText">Showing 0–0</div>
      <div class="sort-menu-wrapper">
        <div class="sort-menu-trigger" id="sortMenuTrigger">
          <span class="sort-menu-trigger-text">Upload date</span>
          <svg class="sort-menu-arrow" width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 9L1 4H11L6 9Z" fill="currentColor"/>
          </svg>
        </div>
        <div class="sort-menu" id="sortMenu">
          <div class="sort-menu-title">SORT BY</div>
          <div class="sort-menu-separator"></div>
          <div class="sort-option" data-value="name">Name</div>
          <div class="sort-option active" data-value="newest">Upload date</div>
        </div>
      </div>
    </div>

    <div class="products-grid" id="productsGrid"></div>
    <div class="pagination" id="pagination" style="margin-top: 60px;"></div>
  </div>
</main>

<script src="../script.js"></script>
<script src="./unreal-plugins-data.js"></script>
<script>
  // Plugin data loaded from unreal-plugins-data.js

  // Render products
  (function() {
    'use strict';
    
    // Cache DOM elements
    const grid = document.getElementById('productsGrid');
    const productCountElement = document.getElementById('productCount');
    const showingTextElement = document.getElementById('showingText');
    const paginationElement = document.getElementById('pagination');
    const imageFallback = 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'400\' height=\'225\'%3E%3Crect fill=\'%231a1a1a\' width=\'400\' height=\'225\'/%3E%3Ctext fill=\'%23666\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3ENo Image%3C/text%3E%3C/svg%3E';
    const pageSize = 20;
    let currentPage = 1;
    let currentSort = 'newest';
    const storageKey = `listingState:${window.location.pathname}`;
    let pendingScrollY = null;

    function saveListingState() {
      try {
        sessionStorage.setItem(storageKey, JSON.stringify({
          scrollY: window.scrollY || 0,
          page: currentPage,
          sort: currentSort
        }));
      } catch (err) {
        // Ignore storage errors
      }
    }

    function loadListingState() {
      try {
        const raw = sessionStorage.getItem(storageKey);
        return raw ? JSON.parse(raw) : null;
      } catch (err) {
        return null;
      }
    }

    function renderProducts(sortBy = currentSort) {
      if (!grid) return;
      currentSort = sortBy;
      let sorted = [...unrealPlugins];
      if (sortBy === 'name') {
        sorted.sort((a, b) => a.title.localeCompare(b.title, undefined, { sensitivity: 'base' }));
      } else if (sortBy === 'newest') {
        sorted.sort((a, b) => b.id - a.id);
      }
      const total = sorted.length;
      const totalPages = Math.max(1, Math.ceil(total / pageSize));
      if (currentPage > totalPages) currentPage = totalPages;
      const start = total ? (currentPage - 1) * pageSize : 0;
      const end = total ? Math.min(start + pageSize, total) : 0;
      const pageProducts = sorted.slice(start, end);
      productCountElement.textContent = `${total} Plugin${total !== 1 ? 's' : ''}`;
      showingTextElement.textContent = total ? `Showing ${start + 1}–${end}` : 'Showing 0–0';
      const frag = document.createDocumentFragment();
      if (!total) {
        const p = document.createElement('p');
        p.className = 'no-products';
        p.textContent = 'No Unreal Plugins available yet';
        frag.appendChild(p);
      } else {
        pageProducts.forEach(p => {
          const card = document.createElement('div');
          card.className = 'product-card';
          let mouseDownX = 0;
          let mouseDownY = 0;
          let isSelecting = false;
          let mouseMoved = false;
          
          card.onmousedown = (e) => {
            mouseDownX = e.clientX;
            mouseDownY = e.clientY;
            isSelecting = false;
            mouseMoved = false;
          };
          
          card.onmousemove = (e) => {
            if (mouseDownX !== 0 || mouseDownY !== 0) {
              // Check if mouse moved significantly (more than 5px)
              const deltaX = Math.abs(e.clientX - mouseDownX);
              const deltaY = Math.abs(e.clientY - mouseDownY);
              if (deltaX > 5 || deltaY > 5) {
                mouseMoved = true;
                isSelecting = true;
              }
            }
          };
          
          card.onmouseup = () => {
            // Reset after a short delay to allow selection check
            setTimeout(() => {
              mouseDownX = 0;
              mouseDownY = 0;
            }, 100);
          };
          
          card.onclick = (e) => {
            // Check if text is selected or user is selecting text
            const selection = window.getSelection();
            const hasSelection = selection && selection.toString().length > 0;
            
            // Check if mouse moved significantly (indicating text selection/copy)
            if (hasSelection || isSelecting || mouseMoved) {
              e.preventDefault();
              e.stopPropagation();
              return false;
            }
            
            saveListingState();
            window.location.href = 'plugin-detail.html?id=' + p.id;
          };
          const esc = p.title.replace(/"/g, '&quot;');
          card.innerHTML = `<div class="product-image-group"><div class="product-image-wrapper"><img src="${p.image}" alt="${esc}" class="product-image" loading="lazy" decoding="async" onerror="this.src='${imageFallback}'"></div></div><div class="product-content-group"><div class="product-info"><h3 class="product-title">${p.title}</h3></div></div><div class="product-meta-group"></div>`;
          frag.appendChild(card);
        });
      }
      grid.innerHTML = '';
      grid.appendChild(frag);
      renderPagination(totalPages);
      if (pendingScrollY !== null) {
        const y = pendingScrollY;
        pendingScrollY = null;
        requestAnimationFrame(() => window.scrollTo(0, y));
      }
    }

    function renderPagination(totalPages) {
      if (!paginationElement || totalPages <= 1) {
        paginationElement.innerHTML = '';
        return;
      }
      const frag = document.createDocumentFragment();
      const btn = (label, page, dis, act) => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = `pagination-button${act ? ' active' : ''}${dis ? ' disabled' : ''}`;
        b.textContent = label;
        b.disabled = dis;
        if (!dis) b.onclick = () => {
          if (page !== currentPage) {
            currentPage = page;
            renderProducts(currentSort);
          }
        };
        return b;
      };
      frag.appendChild(btn('Prev', Math.max(1, currentPage - 1), currentPage === 1));
      for (let i = 1; i <= totalPages; i++) frag.appendChild(btn(String(i), i, false, i === currentPage));
      frag.appendChild(btn('Next', Math.min(totalPages, currentPage + 1), currentPage === totalPages));
      paginationElement.innerHTML = '';
      paginationElement.appendChild(frag);
    }

    // Sort menu logic
    const sortMenuTrigger = document.getElementById('sortMenuTrigger');
    const sortMenu = document.getElementById('sortMenu');
    const sortTriggerText = document.querySelector('.sort-menu-trigger-text');

    if (sortMenuTrigger && sortMenu) {
      const options = sortMenu.querySelectorAll('.sort-option');
      const activeOption = Array.from(options).find(opt => opt.getAttribute('data-value') === currentSort);
      if (activeOption) {
        options.forEach(opt => opt.classList.remove('active'));
        activeOption.classList.add('active');
        if (sortTriggerText) {
          sortTriggerText.textContent = activeOption.textContent;
        }
      }

      sortMenuTrigger.addEventListener('click', () => {
        sortMenu.classList.toggle('open');
      });

      document.addEventListener('click', (e) => {
        if (!sortMenu.contains(e.target) && !sortMenuTrigger.contains(e.target)) {
          sortMenu.classList.remove('open');
        }
      });

      sortMenu.onclick = (e) => {
        const opt = e.target.closest('.sort-option');
        if (!opt) return;
        options.forEach(o => o.classList.remove('active'));
        opt.classList.add('active');
        if (sortTriggerText) sortTriggerText.textContent = opt.textContent;
        currentPage = 1;
        renderProducts(opt.dataset.value);
        sortMenu.classList.remove('open');
      };
    }

    const savedState = loadListingState();
    if (savedState && typeof savedState.scrollY === 'number') {
      pendingScrollY = savedState.scrollY;
      try {
        sessionStorage.removeItem(storageKey);
      } catch (err) {
        // Ignore storage errors
      }
    }
    
    if (unrealPlugins.length === 0) {
      grid.innerHTML = '<p class="no-products">No Unreal Plugins available yet. Add products in script.js</p>';
      if (pendingScrollY !== null) {
        const targetScroll = pendingScrollY;
        pendingScrollY = null;
        requestAnimationFrame(() => {
          window.scrollTo(0, targetScroll);
        });
      }
      return;
    }

    if (savedState) {
      if (savedState.sort) currentSort = savedState.sort;
      if (savedState.page) currentPage = savedState.page;
    }

    renderProducts(currentSort);
  })();
</script>
</body>
</html>
